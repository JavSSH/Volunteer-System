{% extends "layout.html" %}
{% block title %}Volunteer Opportunities Management Dashboard{% endblock %}
{% block content %}

<div class="dashboard-wrapper">
  <div class="dashboard-container">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h1 class="m-0">Volunteer Opportunities Management</h1>
      <div class="d-flex gap-2 align-items-center mb-3">
        <!-- Create Entities -->
        <div class="d-flex align-items-center gap-3" style="margin-bottom: 25px;">
          <a href="{{ url_for('other_dashboard') }}" class="plain-btn">Create New Opportunity</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Search & Filters -->
  <form class="card mb-4" method="get" action="{{ url_for('viewOpportunitiesPage') }}">
    <div class="card-header">
      <h5 class="m-0">Search</h5>
    </div>
    <div class="card-body row g-3">
      <div class="col-md-10">
        <label class="form-label">Search opportunities</label>
        <input id="opportunityKeywordInput" name="opportunity_keyword"
               value="{{ request.args.get('opportunity_keyword','') }}"
               type="text" class="form-control"
               placeholder="Enter a name, description, or ID">
      </div>
      <div class="col-md-2 d-flex align-items-end">
        <button class="plain-btn" type="submit"><i class="bi bi-search"></i>Search</button>
      </div>
    </div>
  </form>

  <!-- Opportunities table -->
  {% if not opportunities %}
    <h2 style="text-align:center;">No such opportunity found!</h2>
  {% else %}
  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="m-0">All Opportunities ({{ opportunities|length }})</h5>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-striped table-hover m-0 align-middle">
          <thead class="table-light">
            <tr>
              <th style="width: 80px;">ID</th>
              <th>Name</th>
              <th style="width: 100%;">Description</th>
              <th style="width: 120px;">Status</th>
              <th style="width: 420px;">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for opportunity in opportunities %}
            <tr>
              <td class="text-monospace">{{ opportunity.category_id }}</td>
              <td>{{ opportunity.category_name }}</td>
              <td>{{ opportunity.category_desc }}</td>
              <td>
                {% if opportunity.category_status == 1 %}
                  <span class="badge bg-active">Active</span>
                {% else %}
                  <span class="badge bg-suspended">Suspended</span>
                {% endif %}
              </td>
              <td>
                <div class="btn-toolbar" role="toolbar">
                  <div class="btn-group me-2">
                    <a class="btn btn-primary btn-sm"
                       href="{{ url_for('other_dashboard', category_id=opportunity.category_id) }}">
                      <i class="bi bi-pencil"></i> Update
                    </a>
                  </div>
                  <div class="btn-group me-2">
                    {% if opportunity.category_status == 1 %}
                      <form method="post" action="{{ url_for('other_dashboard', category_id=opportunity.category_id) }}">
                        <button class="btn btn-warning btn-sm" type="submit">
                          <i class="bi bi-pause-circle"></i> Suspend
                        </button>
                      </form>
                    {% else %}
                      <form method="post" action="{{ url_for('other_dashboard', category_id=opportunity.category_id) }}">
                        <button class="btn btn-success btn-sm" type="submit">
                          <i class="bi bi-play-circle"></i> Reactivate
                        </button>
                      </form>
                    {% endif %}
                  </div>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Pagination (optional) -->
    {% if pagination %}
    <div class="card-footer d-flex justify-content-between align-items-center">
      <div class="text-muted small">Page {{ pagination.page }} of {{ pagination.pages }}</div>
      <nav>
        <ul class="pagination m-0">
          <li class="page-item {{ 'disabled' if not pagination.prev_num }}">
            <a class="page-link"
               href="{{ url_for('viewOpportunitiesPage', page=pagination.prev_num, opportunity_keyword=request.args.get('opportunity_keyword')) }}">Prev</a>
          </li>
          <li class="page-item {{ 'disabled' if not pagination.next_num }}">
            <a class="page-link"
               href="{{ url_for('viewOpportunitiesPage', page=pagination.next_num, opportunity_keyword=request.args.get('opportunity_keyword')) }}">Next</a>
          </li>
        </ul>
      </nav>
    </div>
    {% endif %}
  </div>
  {% endif %}
</div>
</div>

<!-- Optional helper styles (can be moved to your CSS) -->
<style>
  .bg-user-admin{background:#4c6ef5}
  .bg-platform-manager{background:#2fb344}
  .bg-pin{background:#f59f00}
  .bg-csr-rep{background:#d6336c}
  .bg-active{background:#198754}
  .bg-suspended{background:#6c757d}
  .text-monospace{
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  }
</style>

<script>
  // Auto-submit when search field is cleared
  document.getElementById('opportunityKeywordInput').addEventListener('input', function() {
    const keyword = this.value.trim().toLowerCase();
    if (keyword === '') {
      setTimeout(() => { document.querySelector('form').submit(); }, 200);
    }
  });
</script>

{% endblock %}
